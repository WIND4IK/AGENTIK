<Window x:Class="AGENTIK.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:i="clr-namespace:System.Windows.Interactivity;assembly=System.Windows.Interactivity"
        xmlns:local="clr-namespace:Agent24"
        xmlns:tbn="clr-namespace:Agent24.TaskbarNotification;assembly=Agent24.TaskbarNotification"
        x:Name="Main"
        Width="338"
        Height="285"
        ShowInTaskbar="False"
        SizeToContent="Height"
        Visibility="Hidden"
        WindowStartupLocation="CenterScreen">

    <Window.Resources>
        <DataTemplate x:Key="OverlayIcon">
            <Grid Width="20" Height="20">
                <Ellipse Fill="Red"
                         Stroke="White"
                         StrokeThickness="2" />

                <TextBlock Height="16"
                           VerticalAlignment="Center"
                           FontSize="12"
                           FontWeight="Bold"
                           Foreground="White"
                           Text="{Binding}"
                           TextAlignment="Center">
                    <TextBlock.Effect>
                        <DropShadowEffect ShadowDepth="0" />
                    </TextBlock.Effect>
                </TextBlock>
            </Grid>
        </DataTemplate>

        <RoutedUICommand x:Key="LogoutCommand" Text="Logout" />
        <RoutedUICommand x:Key="RefreshCommand" Text="Обновить" />
    </Window.Resources>

    <Window.TaskbarItemInfo>
        <TaskbarItemInfo />
    </Window.TaskbarItemInfo>
    <Grid>

        <!--  the ToolTipText property is bound to the TextBox below  -->
        <tbn:TaskbarIcon x:Name="MyNotifyIcon"
                         IconSource="/Icons/Error.ico"
                         ToolTipText="Мой Секретарь"
                         TrayMouseDoubleClick="MyNotifyIcon_OnTrayMouseDoubleClick">
            <tbn:TaskbarIcon.ContextMenu>
                <ContextMenu>
                    <ContextMenu.CommandBindings>
                        <CommandBinding CanExecute="OnCanExecute"
                                        Command="{StaticResource LogoutCommand}"
                                        Executed="LogoutOnExecuted" />
                        <CommandBinding CanExecute="OnCanExecute"
                                        Command="{StaticResource RefreshCommand}"
                                        Executed="RefreshOnExecuted" />
                    </ContextMenu.CommandBindings>
                    <MenuItem Click="OnLoginClick" Header="Login" />
                    <MenuItem Command="{StaticResource LogoutCommand}" Header="Logout" />
                    <Separator />
                    <MenuItem Command="{StaticResource RefreshCommand}" Header="Обновить" />
                    <Separator />
                    <MenuItem Click="OnExitClick" Header="Выход" />
                </ContextMenu>
            </tbn:TaskbarIcon.ContextMenu>
        </tbn:TaskbarIcon>

        <Grid x:Name="grid">
            <Border HorizontalAlignment="Stretch"
                    BorderBrush="#FF997137"
                    BorderThickness="1,1,1,1">
                <Border.Effect>
                    <DropShadowEffect Color="#FF747474" />
                </Border.Effect>
                <Border.Background>
                    <LinearGradientBrush StartPoint="0.5,0" EndPoint="0.5,1">
                        <GradientStop Offset="0" Color="#FFFBFBFB" />
                        <GradientStop Offset="1" Color="#FFBABBBA" />
                    </LinearGradientBrush>
                </Border.Background>
            </Border>

            <TabControl Margin="10,54,10,15" Background="{x:Null}">
                <TabItem IsSelected="True">
                    <TabItem.Header>
                        <TextBlock Background="{x:Null}">По клиентам</TextBlock>
                    </TabItem.Header>
                    <TreeView x:Name="_treeView"
                              Margin="5,5,5,5"
                              HorizontalContentAlignment="Stretch"
                              VerticalContentAlignment="Stretch"
                              Background="{x:Null}"
                              BorderBrush="#00000000"
                              Foreground="White"
                              ScrollViewer.HorizontalScrollBarVisibility="Disabled">
                        <TreeView.ItemTemplate>
                            <HierarchicalDataTemplate ItemsSource="{Binding Children}">
                                <TextBlock FontSize="16"
                                           FontWeight="Bold"
                                           Text="{Binding Title}"
                                           ToolTip="{Binding Title}" />
                                <HierarchicalDataTemplate.ItemTemplate>
                                    <DataTemplate>
                                        <TextBlock>
                                            <Hyperlink NavigateUri="{Binding Ticket.Uri}">
                                                <i:Interaction.Behaviors>
                                                    <local:HyperlinkNavigationBehavior />
                                                </i:Interaction.Behaviors>
                                                <Run Text="{Binding Title}" ToolTip="{Binding Title}" />
                                            </Hyperlink>
                                        </TextBlock>
                                    </DataTemplate>
                                </HierarchicalDataTemplate.ItemTemplate>
                            </HierarchicalDataTemplate>
                        </TreeView.ItemTemplate>

                    </TreeView>
                </TabItem>
                <TabItem>
                    <TabItem.Header>
                        <TextBlock Background="{x:Null}">По приоритетам</TextBlock>
                    </TabItem.Header>
                    <ListView x:Name="_listViewPriority"
                              Background="{x:Null}"
                              ScrollViewer.HorizontalScrollBarVisibility="Disabled">
                        <ListView.ItemTemplate>
                            <DataTemplate>
                                <TextBlock>
                                    <Hyperlink NavigateUri="{Binding Uri}">
                                        <i:Interaction.Behaviors>
                                            <local:HyperlinkNavigationBehavior />
                                        </i:Interaction.Behaviors>
                                        <Run Text="{Binding Theme, Mode=OneWay}" ToolTip="{Binding Theme}" />
                                    </Hyperlink>
                                </TextBlock>
                            </DataTemplate>
                        </ListView.ItemTemplate>
                    </ListView>
                </TabItem>
                <TabItem>
                    <TabItem.Header>
                        <TextBlock Background="{x:Null}">По сложности</TextBlock>
                    </TabItem.Header>
                    <ListView x:Name="_listViewStatus"
                              Background="{x:Null}"
                              ScrollViewer.HorizontalScrollBarVisibility="Disabled">
                        <ListView.ItemTemplate>
                            <DataTemplate>
                                <TextBlock>
                                    <Hyperlink NavigateUri="{Binding Uri}">
                                        <i:Interaction.Behaviors>
                                            <local:HyperlinkNavigationBehavior />
                                        </i:Interaction.Behaviors>
                                        <Run Text="{Binding Theme, Mode=OneWay}" ToolTip="{Binding Theme}" />
                                    </Hyperlink>
                                </TextBlock>
                            </DataTemplate>
                        </ListView.ItemTemplate>
                    </ListView>

                </TabItem>
            </TabControl>

            <Path Height="1"
                  Margin="72,48,34,0"
                  VerticalAlignment="Top"
                  Data="M26,107 L220.04123,107"
                  Fill="#FFFFFFFF"
                  SnapsToDevicePixels="True"
                  Stretch="Fill">
                <Path.Stroke>
                    <LinearGradientBrush StartPoint="0.005,0.5" EndPoint="0.973,0.5">
                        <GradientStop Offset="1" Color="#00ECAD25" />
                        <GradientStop Offset="0" Color="#87171716" />
                    </LinearGradientBrush>
                </Path.Stroke>
            </Path>
            <Image x:Name="logo"
                   Width="40"
                   Height="40"
                   Margin="20,10,0,0"
                   HorizontalAlignment="Left"
                   VerticalAlignment="Top"
                   Source="Images/favicon_skylogic.gif" />
            <TextBlock Height="32"
                       Margin="72,10,10,0"
                       VerticalAlignment="Top"
                       FontSize="18"
                       FontWeight="Bold"
                       Foreground="#FF876722"
                       Text="{Binding BalloonText,
                                      ElementName=me,
                                      Mode=Default}"
                       TextWrapping="Wrap" />
        </Grid>

    </Grid>
</Window>
